#labels Phase-Support,Phase-Design
=== Why is it not implemented as [http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/Store.html Store] for tomcats [http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/session/PersistentManagerBase.html PersistentManagerBase]? ===

The [http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/Store.html Store] interface defines methods _getSize()_, _keys()_ and _clear()_ - these cannot be implemented with memcached.

Also [http://tomcat.apache.org/tomcat-6.0-doc/api/org/apache/catalina/session/PersistentManagerBase.html PersistentManagerBase] backups all sessions in batches (_processMaxIdleBackups()_ is called by the background thread after active sessions have been checked for expiration). If each session shall be up to date in the store, all sessions would be sent to memcached again and again.

The memcached-session-manager instead backups a session after the request was finished, so only sessions that were (potentially) modified are sent to memcached.

=== How are memcached nodes selected for session backup? ===
When a new session is created the memcached-session-manager does a simple round robin (random) to select the memcached node where to backup this session.

=== What's the format of the session id when using the memcached-session-manager? ===
The memcached node is encoded in the session id like this: {{{<sessionId>-<node>[.<jvmRoute>]}}} (e.g. {{{602F7397FBE4D9932E59A9D0E52FE178-n1}}} without a jvm route, with the jvm route {{{602F7397FBE4D9932E59A9D0E52FE178-n1.tomcat0}}})

=== Isn't memcached a cache and might drop sessions ===
TBD